{"ast":null,"code":"var _s = $RefreshSig$();\nimport initializeFirebase from \"../Firebase/firebase.init\";\nimport { useState, useEffect } from 'react';\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, getIdToken, signOut } from \"firebase/auth\";\n\n// initialize firebase app\ninitializeFirebase();\nconst useFirebase = () => {\n  _s();\n  const [user, setUser] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [authError, setAuthError] = useState('');\n  const [admin, setAdmin] = useState(false);\n  const [token, setToken] = useState('');\n  const auth = getAuth();\n  const googleProvider = new GoogleAuthProvider();\n  const registerUser = (email, password, name, history) => {\n    setIsLoading(true);\n    createUserWithEmailAndPassword(auth, email, password).then(userCredential => {\n      setAuthError('');\n      const newUser = {\n        email,\n        displayName: name\n      };\n      setUser(newUser);\n      // save user to the database\n      saveUser(email, name, 'POST');\n      // send name to firebase after creation\n      updateProfile(auth.currentUser, {\n        displayName: name\n      }).then(() => {}).catch(error => {});\n      history.replace('/');\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n  const loginUser = (email, password, location, history) => {\n    setIsLoading(true);\n    signInWithEmailAndPassword(auth, email, password).then(userCredential => {\n      var _location$state;\n      const destination = (location === null || location === void 0 ? void 0 : (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.from) || '/dashboard';\n      history.replace(destination);\n      setAuthError('');\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n  const signInWithGoogle = (location, history) => {\n    setIsLoading(true);\n    signInWithPopup(auth, googleProvider).then(result => {\n      var _location$state2;\n      const user = result.user;\n      saveUser(user.email, user.displayName, 'PUT');\n      setAuthError('');\n      const destination = (location === null || location === void 0 ? void 0 : (_location$state2 = location.state) === null || _location$state2 === void 0 ? void 0 : _location$state2.from) || '/';\n      history.replace(destination);\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n\n  // observer user state\n  useEffect(() => {\n    const unsubscribed = onAuthStateChanged(auth, user => {\n      if (user) {\n        setUser(user);\n        getIdToken(user).then(idToken => {\n          localStorage.setItem('idToken', idToken);\n          setToken(idToken);\n        });\n      } else {\n        setUser({});\n      }\n      setIsLoading(false);\n    });\n    return () => unsubscribed;\n  }, [auth]);\n  useEffect(async () => {\n    console.log(\"Fetching User\");\n    await fetch(`http://localhost:5000/users/${user.email}`).then(res => res.json()).then(data => {\n      console.log(data);\n      setAdmin(data.admin);\n      console.log(\" User fetched\");\n    }).catch(err => console.log(err));\n  }, [user.email]);\n  const logout = () => {\n    setIsLoading(true);\n    signOut(auth).then(() => {\n      // Sign-out successful.\n      //Remove Metamask acc info\n      window.localStorage.removeItem(\"connected\");\n    }).catch(error => {\n      // An error happened.\n    }).finally(() => setIsLoading(false));\n  };\n\n  //Save user info into mongo db\n  const saveUser = (email, name, method) => {\n    const user = {\n      email,\n      name\n    };\n    fetch('http://localhost:5000/users', {\n      method: method,\n      headers: {\n        'content-type': 'application/json'\n      },\n      body: JSON.stringify(user)\n    }).then();\n  };\n  const makeAdmin = email => {\n    setIsLoading(true);\n    const user = {\n      email,\n      role: \"admin\"\n    };\n    try {\n      fetch('http://localhost:5000/users', {\n        method: \"PATCH\",\n        headers: {\n          \"authorization\": `Bearer ${localStorage.getItem('idToken')}`,\n          'content-type': 'application/json'\n        },\n        body: JSON.stringify(user)\n      }).then(setIsLoading(false)).catch(error => {\n        setAuthError(error);\n      });\n    } catch (error) {\n      setAuthError(error);\n    }\n  };\n  return {\n    user,\n    admin,\n    token,\n    isLoading,\n    authError,\n    registerUser,\n    loginUser,\n    signInWithGoogle,\n    makeAdmin,\n    logout\n  };\n};\n_s(useFirebase, \"veiQkJ7wj0Q5igJ2FQsTRm7A1mc=\");\nexport default useFirebase;","map":{"version":3,"names":["initializeFirebase","useState","useEffect","getAuth","createUserWithEmailAndPassword","signInWithEmailAndPassword","onAuthStateChanged","GoogleAuthProvider","signInWithPopup","updateProfile","getIdToken","signOut","useFirebase","user","setUser","isLoading","setIsLoading","authError","setAuthError","admin","setAdmin","token","setToken","auth","googleProvider","registerUser","email","password","name","history","then","userCredential","newUser","displayName","saveUser","currentUser","catch","error","replace","message","finally","loginUser","location","destination","state","from","signInWithGoogle","result","unsubscribed","idToken","localStorage","setItem","console","log","fetch","res","json","data","err","logout","window","removeItem","method","headers","body","JSON","stringify","makeAdmin","role","getItem"],"sources":["/Users/akiburrahman/Desktop/Development/Msc/real-estate/real-estate-react/src/hooks/useFirebase.js"],"sourcesContent":["import initializeFirebase from \"../Firebase/firebase.init\";\nimport { useState, useEffect } from 'react';\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, getIdToken, signOut } from \"firebase/auth\";\n\n\n// initialize firebase app\ninitializeFirebase();\n\nconst useFirebase = () => {\n    const [user, setUser] = useState({});\n    const [isLoading, setIsLoading] = useState(false);\n    const [authError, setAuthError] = useState('');\n    const [admin, setAdmin] = useState(false);\n    const [token, setToken] = useState('');\n\n    const auth = getAuth();\n    const googleProvider = new GoogleAuthProvider();\n\n    const registerUser = (email, password, name, history) => {\n        setIsLoading(true);\n        createUserWithEmailAndPassword(auth, email, password)\n            .then((userCredential) => {\n                setAuthError('');\n                const newUser = { email, displayName: name };\n                setUser(newUser);\n                // save user to the database\n                saveUser(email, name, 'POST');\n                // send name to firebase after creation\n                updateProfile(auth.currentUser, {\n                    displayName: name\n                }).then(() => {\n                }).catch((error) => {\n                });\n                history.replace('/');\n            })\n            .catch((error) => {\n                setAuthError(error.message);\n            })\n            .finally(() => setIsLoading(false));\n    };\n\n    const loginUser = (email, password, location, history) => {\n        setIsLoading(true);\n        signInWithEmailAndPassword(auth, email, password)\n            .then((userCredential) => {\n                const destination = location?.state?.from || '/dashboard';\n                history.replace(destination);\n                setAuthError('');\n            })\n            .catch((error) => {\n                setAuthError(error.message);\n            })\n            .finally(() => setIsLoading(false));\n    };\n\n    const signInWithGoogle = (location, history) => {\n        setIsLoading(true);\n        signInWithPopup(auth, googleProvider)\n            .then((result) => {\n                const user = result.user;\n                saveUser(user.email, user.displayName, 'PUT');\n                setAuthError('');\n                const destination = location?.state?.from || '/';\n                history.replace(destination);\n            }).catch((error) => {\n                setAuthError(error.message);\n            }).finally(() => setIsLoading(false));\n    };\n\n    // observer user state\n    useEffect(() => {\n        const unsubscribed = onAuthStateChanged(auth, (user) => {\n            if (user) {\n                setUser(user);\n                getIdToken(user)\n                    .then(idToken => {\n                        localStorage.setItem('idToken', idToken);\n                        setToken(idToken);\n                    });\n            } else {\n                setUser({});\n            }\n            setIsLoading(false);\n        });\n        return () => unsubscribed;\n    }, [auth]);\n\n    useEffect(async () => {\n        console.log(\"Fetching User\");\n        await fetch(`http://localhost:5000/users/${user.email}`)\n            .then(res => res.json())\n            .then(data => {\n                console.log(data);\n                setAdmin(data.admin);\n                console.log(\" User fetched\");\n\n            }).catch(err => console.log(err));\n    }, [user.email]);\n\n    const logout = () => {\n        setIsLoading(true);\n\n        signOut(auth).then(() => {\n            // Sign-out successful.\n            //Remove Metamask acc info\n            window.localStorage.removeItem(\"connected\");\n\n        }).catch((error) => {\n            // An error happened.\n        })\n            .finally(() => setIsLoading(false));\n    };\n\n    //Save user info into mongo db\n    const saveUser = (email, name, method) => {\n        const user = { email, name };\n        fetch('http://localhost:5000/users', {\n            method: method,\n            headers: {\n                'content-type': 'application/json'\n            },\n            body: JSON.stringify(user)\n        }).then();\n    };\n\n    const makeAdmin = (email) => {\n        setIsLoading(true);\n        const user = { email, role: \"admin\" };\n        try {\n            fetch('http://localhost:5000/users', {\n                method: \"PATCH\",\n                headers: {\n                    \"authorization\": `Bearer ${localStorage.getItem('idToken')}`,\n                    'content-type': 'application/json'\n                },\n                body: JSON.stringify(user)\n            })\n                .then(\n                    setIsLoading(false)\n                ).catch((error) => {\n                    setAuthError(error);\n                });\n\n        } catch (error) {\n            setAuthError(error);\n        }\n\n    };\n\n    return {\n        user,\n        admin,\n        token,\n        isLoading,\n        authError,\n        registerUser,\n        loginUser,\n        signInWithGoogle,\n        makeAdmin,\n        logout\n    };\n};\n\nexport default useFirebase;"],"mappings":"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"},"metadata":{},"sourceType":"module"}