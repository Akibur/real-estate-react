{"ast":null,"code":"var _s = $RefreshSig$();\nimport initializeFirebase from \"../Firebase/firebase.init\";\nimport { useState, useEffect } from 'react';\nimport { useMoralis } from \"react-moralis\";\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, getIdToken, signOut } from \"firebase/auth\";\n\n// initialize firebase app\ninitializeFirebase();\nconst useFirebase = () => {\n  _s();\n  const [user, setUser] = useState({});\n  const [isLoading, setIsLoading] = useState(false);\n  const [authError, setAuthError] = useState('');\n  const [admin, setAdmin] = useState(false);\n  const [token, setToken] = useState('');\n  const {\n    enableWeb3,\n    isWeb3Enabled,\n    isWeb3EnableLoading,\n    account,\n    Moralis,\n    deactivateWeb3\n  } = useMoralis();\n  const auth = getAuth();\n  const googleProvider = new GoogleAuthProvider();\n  const registerUser = (email, password, name, history) => {\n    setIsLoading(true);\n    createUserWithEmailAndPassword(auth, email, password).then(userCredential => {\n      setAuthError('');\n      const newUser = {\n        email,\n        displayName: name\n      };\n      setUser(newUser);\n      // save user to the database\n      saveUser(email, name, 'POST');\n      // send name to firebase after creation\n      updateProfile(auth.currentUser, {\n        displayName: name\n      }).then(() => {}).catch(error => {});\n      history.replace('/dashboard');\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n  const loginUser = (email, password, location, history) => {\n    setIsLoading(true);\n    signInWithEmailAndPassword(auth, email, password).then(userCredential => {\n      var _location$state;\n      const destination = (location === null || location === void 0 ? void 0 : (_location$state = location.state) === null || _location$state === void 0 ? void 0 : _location$state.from) || '/dashboard';\n      history.replace(destination);\n      setAuthError('');\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n  const signInWithGoogle = (location, history) => {\n    setIsLoading(true);\n    signInWithPopup(auth, googleProvider).then(result => {\n      var _location$state2;\n      const user = result.user;\n      saveUser(user.email, user.displayName, 'PUT');\n      setAuthError('');\n      const destination = (location === null || location === void 0 ? void 0 : (_location$state2 = location.state) === null || _location$state2 === void 0 ? void 0 : _location$state2.from) || '/';\n      history.replace(destination);\n    }).catch(error => {\n      setAuthError(error.message);\n    }).finally(() => setIsLoading(false));\n  };\n\n  // observer user state\n  useEffect(() => {\n    const unsubscribed = onAuthStateChanged(auth, user => {\n      if (user) {\n        setUser(user);\n        getIdToken(user).then(idToken => {\n          localStorage.setItem('idToken', idToken);\n          setToken(idToken);\n        });\n      } else {\n        setUser({});\n      }\n      setIsLoading(false);\n    });\n    return () => unsubscribed;\n  }, [auth]);\n  useEffect(async () => {\n    console.log(\"Fetching User\");\n    await fetch(`http://localhost:5000/users/${user.email}`).then(res => res.json()).then(data => {\n      console.log(data);\n      setAdmin(data.admin);\n      console.log(\" User fetched\");\n    }).catch(err => console.log(err));\n  }, [user.email]);\n  const logout = () => {\n    setIsLoading(true);\n    signOut(auth).then(() => {\n      // Sign-out successful.\n      //Remove Metamask acc info\n      window.localStorage.removeItem(\"connected\");\n      deactivateWeb3();\n    }).catch(error => {\n      // An error happened.\n    }).finally(() => setIsLoading(false));\n  };\n\n  //Save user info into mongo db\n  const saveUser = (email, name, method) => {\n    const user = {\n      email,\n      name\n    };\n    fetch('http://localhost:5000/users', {\n      method: method,\n      headers: {\n        'content-type': 'application/json'\n      },\n      body: JSON.stringify(user)\n    }).then();\n  };\n  const makeAdmin = email => {\n    setIsLoading(true);\n    const user = {\n      email,\n      role: \"admin\"\n    };\n    try {\n      fetch('http://localhost:5000/users', {\n        method: \"PATCH\",\n        headers: {\n          \"authorization\": `Bearer ${localStorage.getItem('idToken')}`,\n          'content-type': 'application/json'\n        },\n        body: JSON.stringify(user)\n      }).then(setIsLoading(false)).catch(error => {\n        setAuthError(error);\n      });\n    } catch (error) {\n      setAuthError(error);\n    }\n  };\n  return {\n    user,\n    admin,\n    token,\n    isLoading,\n    authError,\n    registerUser,\n    loginUser,\n    signInWithGoogle,\n    makeAdmin,\n    logout\n  };\n};\n_s(useFirebase, \"tR+eW1OAfw/ZtjSEmiZmgASOx9Q=\", false, function () {\n  return [useMoralis];\n});\nexport default useFirebase;","map":{"version":3,"names":["initializeFirebase","useState","useEffect","useMoralis","getAuth","createUserWithEmailAndPassword","signInWithEmailAndPassword","onAuthStateChanged","GoogleAuthProvider","signInWithPopup","updateProfile","getIdToken","signOut","useFirebase","user","setUser","isLoading","setIsLoading","authError","setAuthError","admin","setAdmin","token","setToken","enableWeb3","isWeb3Enabled","isWeb3EnableLoading","account","Moralis","deactivateWeb3","auth","googleProvider","registerUser","email","password","name","history","then","userCredential","newUser","displayName","saveUser","currentUser","catch","error","replace","message","finally","loginUser","location","destination","state","from","signInWithGoogle","result","unsubscribed","idToken","localStorage","setItem","console","log","fetch","res","json","data","err","logout","window","removeItem","method","headers","body","JSON","stringify","makeAdmin","role","getItem"],"sources":["/Users/akiburrahman/Desktop/Development/Msc/real-estate/real-estate-react/src/hooks/useFirebase.js"],"sourcesContent":["import initializeFirebase from \"../Firebase/firebase.init\";\nimport { useState, useEffect } from 'react';\nimport { useMoralis } from \"react-moralis\";\n\nimport { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, updateProfile, getIdToken, signOut } from \"firebase/auth\";\n\n\n// initialize firebase app\ninitializeFirebase();\n\nconst useFirebase = () => {\n    const [user, setUser] = useState({});\n    const [isLoading, setIsLoading] = useState(false);\n    const [authError, setAuthError] = useState('');\n    const [admin, setAdmin] = useState(false);\n    const [token, setToken] = useState('');\n\n    const { enableWeb3, isWeb3Enabled, isWeb3EnableLoading, account, Moralis, deactivateWeb3 } =\n        useMoralis();\n\n    const auth = getAuth();\n    const googleProvider = new GoogleAuthProvider();\n\n    const registerUser = (email, password, name, history) => {\n        setIsLoading(true);\n        createUserWithEmailAndPassword(auth, email, password)\n            .then((userCredential) => {\n                setAuthError('');\n                const newUser = { email, displayName: name };\n                setUser(newUser);\n                // save user to the database\n                saveUser(email, name, 'POST');\n                // send name to firebase after creation\n                updateProfile(auth.currentUser, {\n                    displayName: name\n                }).then(() => {\n                }).catch((error) => {\n                });\n                history.replace('/dashboard');\n            })\n            .catch((error) => {\n                setAuthError(error.message);\n            })\n            .finally(() => setIsLoading(false));\n    };\n\n    const loginUser = (email, password, location, history) => {\n        setIsLoading(true);\n        signInWithEmailAndPassword(auth, email, password)\n            .then((userCredential) => {\n                const destination = location?.state?.from || '/dashboard';\n                history.replace(destination);\n                setAuthError('');\n            })\n            .catch((error) => {\n                setAuthError(error.message);\n            })\n            .finally(() => setIsLoading(false));\n    };\n\n    const signInWithGoogle = (location, history) => {\n        setIsLoading(true);\n        signInWithPopup(auth, googleProvider)\n            .then((result) => {\n                const user = result.user;\n                saveUser(user.email, user.displayName, 'PUT');\n                setAuthError('');\n                const destination = location?.state?.from || '/';\n                history.replace(destination);\n            }).catch((error) => {\n                setAuthError(error.message);\n            }).finally(() => setIsLoading(false));\n    };\n\n    // observer user state\n    useEffect(() => {\n        const unsubscribed = onAuthStateChanged(auth, (user) => {\n            if (user) {\n                setUser(user);\n                getIdToken(user)\n                    .then(idToken => {\n                        localStorage.setItem('idToken', idToken);\n                        setToken(idToken);\n                    });\n            } else {\n                setUser({});\n            }\n            setIsLoading(false);\n        });\n        return () => unsubscribed;\n    }, [auth]);\n\n    useEffect(async () => {\n        console.log(\"Fetching User\");\n        await fetch(`http://localhost:5000/users/${user.email}`)\n            .then(res => res.json())\n            .then(data => {\n                console.log(data);\n                setAdmin(data.admin);\n                console.log(\" User fetched\");\n\n            }).catch(err => console.log(err));\n    }, [user.email]);\n\n    const logout = () => {\n        setIsLoading(true);\n\n        signOut(auth).then(() => {\n            // Sign-out successful.\n            //Remove Metamask acc info\n            window.localStorage.removeItem(\"connected\");\n            deactivateWeb3();\n\n        }).catch((error) => {\n            // An error happened.\n        })\n            .finally(() => setIsLoading(false));\n    };\n\n    //Save user info into mongo db\n    const saveUser = (email, name, method) => {\n        const user = { email, name };\n        fetch('http://localhost:5000/users', {\n            method: method,\n            headers: {\n                'content-type': 'application/json'\n            },\n            body: JSON.stringify(user)\n        }).then();\n    };\n\n    const makeAdmin = (email) => {\n        setIsLoading(true);\n        const user = { email, role: \"admin\" };\n        try {\n            fetch('http://localhost:5000/users', {\n                method: \"PATCH\",\n                headers: {\n                    \"authorization\": `Bearer ${localStorage.getItem('idToken')}`,\n                    'content-type': 'application/json'\n                },\n                body: JSON.stringify(user)\n            })\n                .then(\n                    setIsLoading(false)\n                ).catch((error) => {\n                    setAuthError(error);\n                });\n\n        } catch (error) {\n            setAuthError(error);\n        }\n\n    };\n\n    return {\n        user,\n        admin,\n        token,\n        isLoading,\n        authError,\n        registerUser,\n        loginUser,\n        signInWithGoogle,\n        makeAdmin,\n        logout\n    };\n};\n\nexport default useFirebase;"],"mappings":"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"},"metadata":{},"sourceType":"module"}